<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾æ ‡ç¼“å­˜è°ƒè¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto;
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        .success { background: #e8f5e8; }
        .error { background: #ffe8e8; }
        .warning { background: #fff3cd; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007cba; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #005a87; }
        .purple { background: #6f42c1; }
        .purple:hover { background: #5a2d91; }
        pre { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 12px;
        }
        .icon-test {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        .icon-test img {
            width: 32px;
            height: 32px;
            display: block;
            margin: 0 auto 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å›¾æ ‡ç¼“å­˜è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h3>1. å¿«é€Ÿæµ‹è¯•</h3>
        <button onclick="testDomain('github.com')" class="purple">æµ‹è¯• GitHub</button>
        <button onclick="testDomain('google.com')" class="purple">æµ‹è¯• Google</button>
        <button onclick="testDomain('baidu.com')" class="purple">æµ‹è¯• ç™¾åº¦</button>
        <button onclick="testCustomDomain()">æµ‹è¯•è‡ªå®šä¹‰åŸŸå</button>
    </div>
    
    <div class="section">
        <h3>2. å›¾æ ‡æ˜¾ç¤ºæµ‹è¯•</h3>
        <div id="icon-display"></div>
    </div>
    
    <div class="section">
        <h3>3. è°ƒè¯•ç»“æœ</h3>
        <div id="debug-results"></div>
    </div>

    <script>
        async function testDomain(domain) {
            const resultsDiv = document.getElementById('debug-results');
            const iconDiv = document.getElementById('icon-display');
            
            resultsDiv.innerHTML = `<p>æ­£åœ¨æµ‹è¯• ${domain}...</p>`;
            
            try {
                // æµ‹è¯•è°ƒè¯•API
                const response = await fetch(`/api/debug-cache?domain=${domain}`);
                const result = await response.json();
                
                // æ˜¾ç¤ºç»“æœ
                resultsDiv.innerHTML = `
                    <div class="${result.success ? 'success' : 'error'}">
                        <h4>è°ƒè¯•ç»“æœ - ${domain}</h4>
                        <p><strong>çŠ¶æ€:</strong> ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</p>
                        ${result.error ? `<p><strong>é”™è¯¯:</strong> ${result.error}</p>` : ''}
                        <details>
                            <summary>è¯¦ç»†ä¿¡æ¯</summary>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                // æ˜¾ç¤ºå›¾æ ‡
                iconDiv.innerHTML = `
                    <div class="icon-test">
                        <img src="/api/debug-cache?domain=${domain}&returnImage=true" 
                             alt="${domain}" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjZGQzMzMzIi8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4/PC90ZXh0Pjwvc3ZnPg=='">
                        <div>ç¼“å­˜å›¾æ ‡</div>
                    </div>
                    <div class="icon-test">
                        <img src="https://www.google.com/s2/favicons?domain=${domain}&sz=32" 
                             alt="${domain}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjMzM3YWI3Ii8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5HPC90ZXh0Pjwvc3ZnPg=='">
                        <div>Google API</div>
                    </div>
                    <div class="icon-test">
                        <img src="/api/cache-icon?domain=${domain}" 
                             alt="${domain}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjZmY5NTAwIi8+PHRleHQgeD0iMTYiIHk9IjIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5DPC90ZXh0Pjwvc3ZnPg=='">
                        <div>ç¼“å­˜API</div>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>æµ‹è¯•å¤±è´¥</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function testCustomDomain() {
            const input = prompt('è¯·è¾“å…¥è¦æµ‹è¯•çš„åŸŸåæˆ–URL:', 'example.com');
            if (input) {
                // å¦‚æœè¾“å…¥çš„æ˜¯URLï¼Œæå–åŸŸå
                let domain = input;
                try {
                    if (input.includes('://')) {
                        domain = new URL(input).hostname;
                    }
                } catch (error) {
                    // å¦‚æœè§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å€¼
                }
                testDomain(domain);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•GitHub
        window.onload = () => {
            testDomain('github.com');
        };
    </script>
</body>
</html>
