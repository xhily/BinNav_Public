# ç½‘ç«™å›¾æ ‡æ›´æ–°åŠŸèƒ½è°ƒè¯•æŒ‡å—

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæ›´æ–°æŒ‰é’®æ²¡æœ‰æ•ˆæœï¼Œå·²å­˜åœ¨çš„ç«™ç‚¹å›¾æ ‡å¹¶æ²¡æœ‰æ›´æ–°ã€‚

## è°ƒè¯•æ­¥éª¤

### ğŸ” **ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æŒ‰é’®ç‚¹å‡»**

1. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·**ï¼š
   - æŒ‰ F12 æˆ–å³é”®é€‰æ‹©"æ£€æŸ¥"
   - åˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ

2. **æµ‹è¯•å•ä¸ªå›¾æ ‡æ›´æ–°**ï¼š
   - æ‰¾åˆ°ä»»æ„ç½‘ç«™å¡ç‰‡
   - ç‚¹å‡»ç»¿è‰²çš„åˆ·æ–°å›¾æ ‡æŒ‰é’®
   - **æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º**ï¼š
     ```
     ğŸ–±ï¸ ç‚¹å‡»æ›´æ–°å›¾æ ‡æŒ‰é’®: {websiteId: xxx, websiteName: "xxx", websiteUrl: "xxx"}
     ğŸ”„ å¼€å§‹æ›´æ–°å•ä¸ªå›¾æ ‡: {websiteId: xxx, totalWebsites: xx, websiteIds: [...]}
     ğŸ“ æ‰¾åˆ°ç½‘ç«™: {name: "xxx", url: "xxx", currentIcon: "xxx"}
     ğŸ¯ ç”Ÿæˆæ–°å›¾æ ‡: https://www.google.com/s2/favicons?domain=xxx&sz=32
     ğŸ“ æ›´æ–°åçš„ç½‘ç«™åˆ—è¡¨: {totalCount: xx, updatedWebsite: {...}}
     âœ… å›¾æ ‡æ›´æ–°å®Œæˆ: {websiteName: "xxx", oldIcon: "xxx", newIcon: "xxx"}
     ```

3. **æµ‹è¯•æ‰¹é‡å›¾æ ‡æ›´æ–°**ï¼š
   - ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„è“è‰²"æ›´æ–°å›¾æ ‡"æŒ‰é’®
   - **æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º**ï¼š
     ```
     ğŸ–±ï¸ ç‚¹å‡»æ‰¹é‡æ›´æ–°å›¾æ ‡æŒ‰é’®
     ğŸ”„ å¼€å§‹æ‰¹é‡æ›´æ–°å›¾æ ‡: {totalWebsites: xx, websites: [...]}
     ğŸ¯ æ›´æ–° "ç½‘ç«™å": {oldIcon: "xxx", newIcon: "xxx"}
     ğŸ“ æ‰¹é‡æ›´æ–°ç»“æœ: {totalCount: xx, updatedWebsites: [...]}
     âœ… æ‰¹é‡æ›´æ–°å®Œæˆ
     ```

### ğŸ” **ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å¯èƒ½çš„é—®é¢˜**

#### é—®é¢˜1ï¼šæŒ‰é’®ç‚¹å‡»æ²¡æœ‰å“åº”
**ç—‡çŠ¶**ï¼šç‚¹å‡»æŒ‰é’®åæ§åˆ¶å°æ²¡æœ‰ä»»ä½•è¾“å‡º
**å¯èƒ½åŸå› **ï¼š
- æŒ‰é’®äº‹ä»¶ç»‘å®šå¤±è´¥
- JavaScripté”™è¯¯é˜»æ­¢äº†æ‰§è¡Œ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯
2. åˆ·æ–°é¡µé¢é‡è¯•
3. æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯è§ä¸”å¯ç‚¹å‡»

#### é—®é¢˜2ï¼šæ‰¾ä¸åˆ°ç½‘ç«™
**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤º `âŒ æ‰¾ä¸åˆ°ç½‘ç«™: xxx`
**å¯èƒ½åŸå› **ï¼š
- ç½‘ç«™IDç±»å‹ä¸åŒ¹é…ï¼ˆå­—ç¬¦ä¸² vs æ•°å­—ï¼‰
- ç½‘ç«™æ•°æ®ç»“æ„é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `websiteIds` æ•°ç»„ä¸­çš„IDæ ¼å¼
2. ç¡®è®¤ç‚¹å‡»çš„ç½‘ç«™IDæ˜¯å¦åœ¨åˆ—è¡¨ä¸­

#### é—®é¢˜3ï¼šå›¾æ ‡ç”Ÿæˆå¤±è´¥
**ç—‡çŠ¶**ï¼š`newIcon` æ˜¾ç¤ºä¸ºé»˜è®¤å›¾æ ‡è·¯å¾„
**å¯èƒ½åŸå› **ï¼š
- ç½‘ç«™URLæ ¼å¼ä¸æ­£ç¡®
- URLè§£æå¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ç½‘ç«™çš„URLæ˜¯å¦æœ‰æ•ˆ
2. æ‰‹åŠ¨æµ‹è¯•Google Favicon API

#### é—®é¢˜4ï¼šçŠ¶æ€æ›´æ–°å¤±è´¥
**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤ºæ›´æ–°å®Œæˆï¼Œä½†ç•Œé¢æ²¡æœ‰å˜åŒ–
**å¯èƒ½åŸå› **ï¼š
- `onUpdateWebsiteData` å‡½æ•°æ²¡æœ‰æ­£ç¡®æ›´æ–°çŠ¶æ€
- Reactç»„ä»¶æ²¡æœ‰é‡æ–°æ¸²æŸ“

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `onUpdateWebsiteData` å‡½æ•°çš„å®ç°
2. ç¡®è®¤çŠ¶æ€ç®¡ç†æ˜¯å¦æ­£å¸¸å·¥ä½œ

### ğŸ” **ç¬¬ä¸‰æ­¥ï¼šæ‰‹åŠ¨æµ‹è¯•å›¾æ ‡URL**

å¦‚æœè‡ªåŠ¨æ›´æ–°å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æµ‹è¯•å›¾æ ‡URLï¼š

1. **è·å–ç½‘ç«™åŸŸå**ï¼š
   - ä¾‹å¦‚ï¼š`https://github.com` â†’ `github.com`

2. **æ„é€ å›¾æ ‡URL**ï¼š
   - æ ¼å¼ï¼š`https://www.google.com/s2/favicons?domain=github.com&sz=32`

3. **åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•**ï¼š
   - ç›´æ¥åœ¨åœ°å€æ è¾“å…¥å›¾æ ‡URL
   - ç¡®è®¤æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤ºå›¾æ ‡

### ğŸ” **ç¬¬å››æ­¥ï¼šæ£€æŸ¥ç½‘ç«™æ•°æ®ç»“æ„**

åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ•°æ®ç»“æ„ï¼š

```javascript
// æ£€æŸ¥ç½‘ç«™æ•°æ®
console.log('ç½‘ç«™æ•°æ®:', config.websiteData)

// æ£€æŸ¥ç‰¹å®šç½‘ç«™
const website = config.websiteData[0]
console.log('ç¬¬ä¸€ä¸ªç½‘ç«™:', website)
console.log('ç½‘ç«™IDç±»å‹:', typeof website.id)
console.log('ç½‘ç«™URL:', website.url)
console.log('å½“å‰å›¾æ ‡:', website.icon)
```

### ğŸ”§ **å¸¸è§ä¿®å¤æ–¹æ³•**

#### ä¿®å¤1ï¼šIDç±»å‹ä¸åŒ¹é…
å¦‚æœç½‘ç«™IDæ˜¯æ•°å­—ä½†ä¼ é€’çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¿®æ”¹æ¯”è¾ƒé€»è¾‘ï¼š
```javascript
// å·²ä¿®å¤ï¼šä½¿ç”¨ == è€Œä¸æ˜¯ === æ¥å¤„ç†ç±»å‹å·®å¼‚
const website = config.websiteData.find(w => w.id == websiteId)
```

#### ä¿®å¤2ï¼šURLæ ¼å¼é—®é¢˜
ç¡®ä¿ç½‘ç«™URLåŒ…å«åè®®ï¼š
```javascript
// æ£€æŸ¥URLæ ¼å¼
const url = website.url.startsWith('http') ? website.url : `https://${website.url}`
```

#### ä¿®å¤3ï¼šå¼ºåˆ¶é‡æ–°æ¸²æŸ“
å¦‚æœçŠ¶æ€æ›´æ–°ä½†ç•Œé¢æ²¡æœ‰å˜åŒ–ï¼Œå°è¯•å¼ºåˆ¶åˆ·æ–°ï¼š
```javascript
// åœ¨æ›´æ–°åæ·»åŠ 
window.location.reload()
```

## é¢„æœŸç»“æœ

æ­£å¸¸å·¥ä½œæ—¶åº”è¯¥çœ‹åˆ°ï¼š

1. **ç‚¹å‡»æŒ‰é’®**ï¼šæ§åˆ¶å°ç«‹å³æ˜¾ç¤ºç‚¹å‡»æ—¥å¿—
2. **æ‰¾åˆ°ç½‘ç«™**ï¼šæ˜¾ç¤ºç½‘ç«™ä¿¡æ¯å’Œå½“å‰å›¾æ ‡
3. **ç”Ÿæˆæ–°å›¾æ ‡**ï¼šæ˜¾ç¤ºGoogle Favicon APIçš„URL
4. **æ›´æ–°æˆåŠŸ**ï¼šæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å’Œæ–°å›¾æ ‡URL
5. **ç•Œé¢æ›´æ–°**ï¼šç½‘ç«™å¡ç‰‡çš„å›¾æ ‡ç«‹å³å˜åŒ–

## å¦‚æœä»ç„¶æ— æ•ˆ

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æ§åˆ¶å°å®Œæ•´è¾“å‡º**ï¼šåŒ…æ‹¬æ‰€æœ‰æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
2. **ç½‘ç«™æ•°æ®ç¤ºä¾‹**ï¼šä¸€ä¸ªæ— æ³•æ›´æ–°çš„ç½‘ç«™çš„å®Œæ•´æ•°æ®
3. **æµè§ˆå™¨ä¿¡æ¯**ï¼šæµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
4. **æ“ä½œæ­¥éª¤**ï¼šå…·ä½“ç‚¹å‡»äº†å“ªä¸ªæŒ‰é’®

## ğŸ”§ é—®é¢˜è§£å†³æ–¹æ¡ˆ

### æ ¹æ®ç”¨æˆ·åé¦ˆçš„è°ƒè¯•ç»“æœ

ç”¨æˆ·æä¾›çš„æ§åˆ¶å°æ—¥å¿—æ˜¾ç¤ºï¼š
```
oldIcon: "https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32"
newIcon: "https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32"
```

**é—®é¢˜åˆ†æ**ï¼š
1. âœ… æ›´æ–°é€»è¾‘æ­£å¸¸å·¥ä½œ
2. âœ… æ•°æ®æˆåŠŸæ›´æ–°
3. âŒ å›¾æ ‡URLç›¸åŒï¼Œå¯¼è‡´æµè§ˆå™¨ç¼“å­˜é—®é¢˜

### ä¿®å¤æ–¹æ¡ˆ

#### 1. **æ·»åŠ æ—¶é—´æˆ³é˜²ç¼“å­˜**
```javascript
// ä¿®å¤å‰ï¼šç›¸åŒURLå¯¼è‡´ç¼“å­˜
const getWebsiteIcon = (url) => {
  const domain = new URL(url).hostname
  return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`
}

// ä¿®å¤åï¼šæ·»åŠ æ—¶é—´æˆ³å¼ºåˆ¶åˆ·æ–°
const getWebsiteIcon = (url, forceRefresh = false) => {
  const domain = new URL(url).hostname
  const baseUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`

  if (forceRefresh) {
    return `${baseUrl}&t=${Date.now()}` // æ·»åŠ æ—¶é—´æˆ³
  }

  return baseUrl
}
```

#### 2. **å¼ºåˆ¶åˆ·æ–°å›¾ç‰‡ç¼“å­˜**
```javascript
// æ›´æ–°åå¼ºåˆ¶é‡æ–°åŠ è½½å›¾ç‰‡
setTimeout(() => {
  const images = document.querySelectorAll(`img[alt="${website.name}"]`)
  images.forEach(img => {
    const src = img.src
    img.src = ''      // æ¸…ç©ºsrc
    img.src = src     // é‡æ–°è®¾ç½®srcï¼Œå¼ºåˆ¶é‡æ–°åŠ è½½
  })
}, 100)
```

#### 3. **è°ƒç”¨æ—¶ä½¿ç”¨å¼ºåˆ¶åˆ·æ–°**
```javascript
// å•ä¸ªæ›´æ–°
const newIcon = getWebsiteIcon(website.url, true) // å¼ºåˆ¶åˆ·æ–°

// æ‰¹é‡æ›´æ–°
const newIcon = getWebsiteIcon(website.url, true) // å¼ºåˆ¶åˆ·æ–°
```

### ç°åœ¨çš„å·¥ä½œæµç¨‹

1. **ç‚¹å‡»æ›´æ–°æŒ‰é’®**
2. **ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–°å›¾æ ‡URL**ï¼š
   ```
   https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32&t=1704067200000
   ```
3. **æ›´æ–°æ•°æ®çŠ¶æ€**
4. **å¼ºåˆ¶åˆ·æ–°é¡µé¢å›¾ç‰‡ç¼“å­˜**
5. **æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯**

### é¢„æœŸæ•ˆæœ

ç°åœ¨æ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š
```
ğŸ¯ ç”Ÿæˆæ–°å›¾æ ‡: https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32&t=1704067200000
âœ… å›¾æ ‡æ›´æ–°å®Œæˆ: {
  websiteName: "Newbie Village",
  oldIcon: "https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32",
  newIcon: "https://www.google.com/s2/favicons?domain=blog.nbvil.com&sz=32&t=1704067200000"
}
```

**å…³é”®å˜åŒ–**ï¼š
- âœ… `newIcon` ç°åœ¨åŒ…å«æ—¶é—´æˆ³å‚æ•°
- âœ… å›¾ç‰‡ä¼šå¼ºåˆ¶é‡æ–°åŠ è½½
- âœ… ç•Œé¢åº”è¯¥ç«‹å³æ˜¾ç¤ºæ›´æ–°åçš„å›¾æ ‡

è¿™å°†å¸®åŠ©æˆ‘ä»¬è¿›ä¸€æ­¥è¯Šæ–­å’Œè§£å†³é—®é¢˜ã€‚
